<!DOCTYPE html> <!-- webkit-test-runner [ useFlexibleViewport=true ] -->
<html>
<head>
<script src="../../../resources/ui-helper.js"></script>
<script src="../../../resources/basic-gestures.js"></script>
<meta name=viewport content="width=device-width">
<style>
body, html {
    width: 100%;
    height: 100%;
    margin: 0;
}

#output {
    width: 320px;
    height: 160px;
    overflow: scroll;
    color: green;
    border: 1px green solid;
}

input {
    font-size: 150px;
    width: 300px;
    height: 100px;
    padding-left: 0;
}
</style>
<script>
if (window.testRunner) {
    testRunner.dumpAsText();
    testRunner.waitUntilDone();
}

function appendOutput(s) {
    const paragraph = document.createElement("div");
    paragraph.textContent = s;
    output.appendChild(paragraph);
}

async function runTest() {
    // First, focus the input.
    await UIHelper.activateAt(100, 50);
    await UIHelper.waitForDoubleTapDelay();

    // Then, select 'aa' with a tap-and-half gesture.
    await UIHelper.activateAt(100, 50);
    await longPressAtPoint(100, 50);

    let grabberEndRect = null;
    while (!grabberEndRect || !grabberEndRect.width || !grabberEndRect.height)
        grabberEndRect = await UIHelper.getSelectionEndGrabberViewRect();

    appendOutput(`Selected range: (${input.selectionStart}, ${input.selectionEnd})`);

    testRunner.notifyDone();
}
</script>
</head>

<body onload="runTest()">
<input id="input" value="aa">
<pre id="output"></pre>
<p>Verifies that text inside an input element can be selected using a tap-and-half gesture.</p>
<p>To manually test, tap once to focus the input. Then tap and tap and hold in quick succession to select the word "aa".</p>
<p>This test is best run under WebKitTestRunner.</p></body>
</html>
