<!DOCTYPE html>
<html>
<head>
<meta name="fuzzy" content="maxDifference=0-100; totalPixels=0-432" />
<title>This tests that we paint area outline properly when the paintroot is shifted.</title>
<style>
.paintroot {
  transform: translateZ(0);
  position: absolute;
  left: 5px;
  top: 5px;
}
</style>
<script>
function waitForElementReady(id) {
    return new Promise((resolve) => {
        const element = document.getElementById(id);
        if (element) {
            if (element.tagName === 'IMG' && (!element.complete || !element.src)) {
                element.addEventListener('load', () => {
                    resolve();
                });
                return;
            }
            resolve();
            return;
        }

        const observer = new MutationObserver((mutations, obs) => {
            const currentElement = document.getElementById(id);
            if (currentElement && currentElement.complete !== false) {
                obs.disconnect();
                resolve();
            }
        });
        observer.observe(document.body, {
          childList: true,
          subtree: true,
          attributes: true
        });
    });
}

if (window.testRunner)
    testRunner.waitUntilDone();

window.onload = async function() {
    await waitForElementReady("image");
    await waitForElementReady("area");
    document.getElementById("area").focus();
    if (window.testRunner)
        testRunner.notifyDone();
}
</script>
</head>
<body>
<div class=paintroot>
  <img src="./resources/green.jpg" id=image width=50 height=50 usemap="#map"/>
  <map name="map"><area id=area shape="rectangle" coords="5, 5, 25, 25" href="#"></map>
</div>
</body>
</html>
